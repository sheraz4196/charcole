# Error Handling Architecture Diagram

## Complete Error Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         HTTP REQUEST                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CORS & BODY PARSING MIDDLEWARE                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       REQUEST LOGGER MIDDLEWARE                      â”‚
â”‚  (Logs: method, path, query, IP, user-agent)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VALIDATION MIDDLEWARE (optional)                  â”‚
â”‚                                                                      â”‚
â”‚  Validates with Zod schema â†’ throws ValidationError if fails       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ROUTE HANDLER (wrapped with asyncHandler)              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ asyncHandler(async (req, res) => {                             â”‚ â”‚
â”‚  â”‚   // Your handler code                                         â”‚ â”‚
â”‚  â”‚   const user = await User.findById(req.params.id);            â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚   if (!user) {                                                â”‚ â”‚
â”‚  â”‚     throw new NotFoundError("User", { id: req.params.id });   â”‚ â”‚
â”‚  â”‚   }                                                            â”‚ â”‚
â”‚  â”‚                                                                â”‚ â”‚
â”‚  â”‚   sendSuccess(res, user);                                     â”‚ â”‚
â”‚  â”‚ })                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â†’ Success? â”€â”€â†’ sendSuccess() â”€â”€â†’ [END: Response sent]
         â”‚
         â””â”€â”€â†’ Error thrown âœ˜ â”€â”€â†’ [Continue below]
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GLOBAL ERROR HANDLER MIDDLEWARE                         â”‚
â”‚  (This is where ALL errors flow!)                                   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ERROR NORMALIZATION                               â”‚
â”‚                                                                      â”‚
â”‚  if (err instanceof AppError)     â†’ Use as is                       â”‚
â”‚  if (err instanceof ZodError)     â†’ Convert to ValidationError      â”‚
â”‚  if (err instanceof TypeError)    â†’ Convert to InternalServerError  â”‚
â”‚  if (err instanceof ReferenceError)â†’ Convert to InternalServerError â”‚
â”‚  if (err instanceof SyntaxError)  â†’ Convert to InternalServerError  â”‚
â”‚  if (err instanceof RangeError)   â†’ Convert to InternalServerError  â”‚
â”‚  else                             â†’ Wrap in InternalServerError     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ERROR CLASSIFICATION                              â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€ Operational Error (isOperational: true)                        â”‚
â”‚  â”‚  â”œâ”€ ValidationError (422)                                       â”‚
â”‚  â”‚  â”œâ”€ NotFoundError (404)                                         â”‚
â”‚  â”‚  â”œâ”€ AuthenticationError (401)                                   â”‚
â”‚  â”‚  â”œâ”€ AuthorizationError (403)                                    â”‚
â”‚  â”‚  â”œâ”€ ConflictError (409)                                         â”‚
â”‚  â”‚  â””â”€ BadRequestError (400)                                       â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€ Programmer Error (isOperational: false)                        â”‚
â”‚     â””â”€ TypeError, ReferenceError, SyntaxError, etc.                â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ERROR LOGGING                                   â”‚
â”‚                                                                      â”‚
â”‚  If Operational Error:                                              â”‚
â”‚  â”œâ”€ Log as WARN level                                              â”‚
â”‚  â”œâ”€ Include: code, message, statusCode, method, path, IP           â”‚
â”‚  â””â”€ NO stack trace (expected error)                                â”‚
â”‚                                                                      â”‚
â”‚  If Programmer Error:                                               â”‚
â”‚  â”œâ”€ Log as ERROR level                                             â”‚
â”‚  â”œâ”€ Include: code, message, statusCode, method, path, IP, stack    â”‚
â”‚  â””â”€ YES full stack trace (for debugging)                           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SEND ERROR RESPONSE                                 â”‚
â”‚                                                                      â”‚
â”‚  If Production & Programmer Error:                                  â”‚
â”‚  â”œâ”€ {                                                               â”‚
â”‚  â”‚   success: false,                                               â”‚
â”‚  â”‚   message: "Internal server error",                             â”‚
â”‚  â”‚   code: "INTERNAL_SERVER_ERROR",                                â”‚
â”‚  â”‚   timestamp: "..."                                              â”‚
â”‚  â”‚ }                                                                â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€ (Details hidden from client)                                   â”‚
â”‚                                                                      â”‚
â”‚  If Development OR Operational Error:                               â”‚
â”‚  â”œâ”€ {                                                               â”‚
â”‚  â”‚   success: false,                                               â”‚
â”‚  â”‚   message: "Full error message",                                â”‚
â”‚  â”‚   code: "ERROR_CODE",                                           â”‚
â”‚  â”‚   statusCode: 422,                                              â”‚
â”‚  â”‚   context: { ... },                                             â”‚
â”‚  â”‚   errors: [ ... ],  // for validation errors                    â”‚
â”‚  â”‚   timestamp: "..."                                              â”‚
â”‚  â”‚ }                                                                â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€ (Full details sent)                                            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  HTTP RESPONSE SENT TO CLIENT                        â”‚
â”‚                                                                      â”‚
â”‚  Status Code: 400, 401, 403, 404, 409, 422, 500, etc.              â”‚
â”‚  Body: Consistent JSON error format                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Class Hierarchy

```
Error (JavaScript)
  â”‚
  â””â”€â”€ AppError (Base class)
      â”‚
      â”œâ”€â”€ ValidationError         (422 - Input validation failed)
      â”œâ”€â”€ BadRequestError         (400 - Malformed request)
      â”œâ”€â”€ AuthenticationError     (401 - Auth failed)
      â”œâ”€â”€ AuthorizationError      (403 - Permission denied)
      â”œâ”€â”€ NotFoundError           (404 - Resource not found)
      â”œâ”€â”€ ConflictError           (409 - Duplicate/conflict)
      â””â”€â”€ InternalServerError     (500 - Unexpected error)
```

## Middleware Stack Order

```
Express App
â”‚
â”œâ”€ Trust Proxy
â”œâ”€ CORS
â”œâ”€ JSON Body Parser
â”œâ”€ URL Encoded Parser
â”œâ”€ Request Timeout Handler
â”‚
â”œâ”€ requestLogger (logs all requests)
â”‚
â”œâ”€ Routes:
â”‚  â”‚
â”‚  â”œâ”€ validateRequest (optional, per route)
â”‚  â”‚
â”‚  â””â”€ Route Handler (MUST wrap with asyncHandler)
â”‚
â””â”€ errorHandler (MUST BE LAST)
   â””â”€ Catches all errors and sends JSON response
```

## Error Classification Decision Tree

```
                           Error Thrown
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                       â”‚
               Is AppError?            Is ZodError?
                    â”‚                       â”‚
                   YES                     YES
                    â”‚                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Use as is      â”‚      â”‚ Convert to      â”‚
            â”‚ (already has   â”‚      â”‚ ValidationError â”‚
            â”‚  isOperational)â”‚      â”‚ (422)           â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                               â”‚
              Is Operational?                              Is Programmer Error?
              (isOperational: true)                        (Syntax, Type, Ref, Range)
                    â”‚                                               â”‚
                   YES                                             YES
                    â”‚                                               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Send full error     â”‚                        â”‚ Convert to          â”‚
         â”‚ details to client   â”‚                        â”‚ InternalServerError â”‚
         â”‚ with code & context â”‚                        â”‚ (500)               â”‚
         â”‚                     â”‚                        â”‚ isOperational: falseâ”‚
         â”‚ Log as WARN         â”‚                        â”‚                     â”‚
         â”‚ (no stack)          â”‚                        â”‚ Log as ERROR        â”‚
         â”‚                     â”‚                        â”‚ WITH FULL STACK     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚                     â”‚
                                                        â”‚ Hide details in     â”‚
                                                        â”‚ production          â”‚
                                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Request-to-Response Timeline

```
TIME  LAYER                  ACTION
â•â•â•â•  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

T0    Network               Request arrives at server

T1    Express Middleware    CORS, Body Parser, Request Logger

T2    Route Handler         validateRequest() - validates input

T3    Route Handler         Handler executes (wrapped with asyncHandler)
                            â”œâ”€ Success: sendSuccess() â†’ Response sent â†’ T6
                            â””â”€ Error: Thrown â†’ T4

T4    asyncHandler          Catches error, passes to next(error)

T5    Error Handler Mw      Normalizes error
                            Classifies (operational vs programmer)
                            Logs error with context
                            Sanitizes response (production)
                            Sends JSON response

T6    Network               Response sent to client
```

## Environment Behavior

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    DEVELOPMENT       â”‚           â”‚    PRODUCTION        â”‚
â”‚  NODE_ENV=developmentâ”‚           â”‚  NODE_ENV=production â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                  â”‚
           â”‚ Programmer Error:                â”‚ Programmer Error:
           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ â”‚ {                      â”‚       â”‚ â”‚ {                      â”‚
           â”‚ â”‚   success: false,      â”‚       â”‚ â”‚   success: false,      â”‚
           â”‚ â”‚   message: "TypeError: â”‚       â”‚ â”‚   message: "Internal   â”‚
           â”‚ â”‚   x is undefined",     â”‚       â”‚ â”‚   server error",       â”‚
           â”‚ â”‚   code: "INTERNAL...", â”‚       â”‚ â”‚   code: "INTERNAL...", â”‚
           â”‚ â”‚   stack: "TypeError... â”‚       â”‚ â”‚   timestamp: "..."     â”‚
           â”‚ â”‚   at handler.js:15..." â”‚       â”‚ â”‚ }                      â”‚
           â”‚ â”‚ }                      â”‚       â”‚ â”‚                        â”‚
           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                  â”‚
           â”‚ Operational Error:               â”‚ Operational Error:
           â”‚ (sent fully in both)             â”‚ (sent fully in both)
           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ â”‚ {                      â”‚       â”‚ â”‚ {                      â”‚
           â”‚ â”‚   success: false,      â”‚       â”‚ â”‚   success: false,      â”‚
           â”‚ â”‚   message: "User not   â”‚       â”‚ â”‚   message: "User not   â”‚
           â”‚ â”‚   found",              â”‚       â”‚ â”‚   found",              â”‚
           â”‚ â”‚   code: "NOT_FOUND",   â”‚       â”‚ â”‚   code: "NOT_FOUND",   â”‚
           â”‚ â”‚   context: {...}       â”‚       â”‚ â”‚   context: {...}       â”‚
           â”‚ â”‚ }                      â”‚       â”‚ â”‚ }                      â”‚
           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                  â”‚
           â”‚ Logging:                         â”‚ Logging:
           â”‚ Full details + stack             â”‚ Full details + stack
           â”‚ (for development)                â”‚ (server-side only)
           â”‚                                  â”‚
```

---

This architecture ensures that **every single error in your application flows through one place, gets properly classified, logged with full context, and returns a consistent JSON response to the client.**

That's production-grade error handling. ğŸ¯
